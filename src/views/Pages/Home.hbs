{{#> layout name="main" }}
<div class="container pt-3">
    <div class="row justify-content-center">
        <div class="col-md-8 col-lg-6">
            <div class="card shadow-lg position-relative">
                <!-- grey overlay -->
                <div id="contentOverlay"
                    class="position-absolute top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center"
                    style="background-color: rgba(0,0,0,0.7); z-index: 10; border-radius: inherit;">
                    <div class="text-center p-4 rounded bg-dark bg-opacity-75">
                        <h2 class="text-white mb-4">Ready to find your next meal?</h2>
                        <button class="btn btn-lg btn-primary px-4 py-2" data-bs-toggle="modal"
                            data-bs-target="#startSessionModal">
                            <i class="bi bi-people-fill me-2"></i>Start!
                        </button>
                    </div>
                </div>

                <div class="card-body p-0">
                    <!-- main card -->
                    <div id="restaurant-card" class="position-relative">
                        <div class="position-relative">
                            <img src="https://lh5.googleusercontent.com/p/AF1QipOvUPyym4NErFKQ4HOBVVnwOR2GMVVjQmQDuoGe=w520-h350-n-k-no"
                                class="card-img-top" alt="Restaurant Image">
                            <button id="info-btn"
                                class="btn btn-light btn-sm rounded-3 position-absolute bottom-0 end-0 m-3 shadow">
                                <i class="bi bi-info-lg"></i> Details
                            </button>
                        </div>
                        <div class="p-3">
                            <h4 id="restaurant-name">Cosmos</h4>
                            <div class="mb-2">
                                <span class="badge bg-success me-1">$$</span>
                                <span class="badge bg-secondary me-1">4.5 â˜…</span>
                                <span class="badge bg-info">Pizza restaurant</span>
                            </div>
                            <p id="restaurant-description" class="mb-2">No-nonsense, mostly take-out & delivery
                                operation offering thin-crust, New York-style pies.</p>
                            <p class="text-muted small mb-0">0.5 miles away</p>
                        </div>
                    </div>

                    <div class="swipe-controls d-flex justify-content-around py-3 bg-light">
                        <button id="dislike-btn" class="btn btn-lg btn-outline-danger rounded-3 px-4" disabled>
                            <i class="bi bi-x-lg"></i> Nope
                        </button>
                        <button id="like-btn" class="btn btn-lg btn-outline-success rounded-3 px-4" disabled>
                            <i class="bi bi-heart-fill"></i> Like
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- make a group card -->
<div class="modal fade" id="startSessionModal" tabindex="-1" aria-labelledby="startSessionModalLabel"
    aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="startSessionModalLabel">Start a Group Session</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="mb-3">
                        <label class="form-label">Select Friends</label>
                        <div class="list-group">
                            <label class="list-group-item">
                                <input class="form-check-input me-1" type="checkbox" value="">
                                Friend 1
                            </label>
                            <label class="list-group-item">
                                <input class="form-check-input me-1" type="checkbox" value="">
                                Friend 2
                            </label>
                            <label class="list-group-item">
                                <input class="form-check-input me-1" type="checkbox" value="">
                                Friend 3
                            </label>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="location" class="form-label">Location</label>
                        <input type="text" class="form-control" id="location" placeholder="Search location...">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Food Preferences (optional)</label>
                        <div class="d-flex flex-wrap gap-2">
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" id="italian" value="italian">
                                <label class="form-check-label" for="italian">Italian</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" id="mexican" value="mexican">
                                <label class="form-check-label" for="mexican">Mexican</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" id="asian" value="asian">
                                <label class="form-check-label" for="asian">Asian</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" id="fastfood" value="fastfood">
                                <label class="form-check-label" for="fastfood">Fast Food</label>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="startSessionBtn">Start Swiping</button>
            </div>
        </div>
    </div>
</div>

<!-- valid match card -->
<div class="modal fade" id="matchModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-body text-center py-4">
                <h3 class="display-6 mb-4">It's a Match!</h3>
                <div class="match-restaurant mb-3">
                    <img src="https://lh5.googleusercontent.com/p/AF1QipOvUPyym4NErFKQ4HOBVVnwOR2GMVVjQmQDuoGe=w520-h350-n-k-no"
                        class="rounded mb-2 img-fluid" alt="Restaurant" style="max-width: 100%;">
                    <h4>Cosmos</h4>
                    <p class="text-muted">Everyone likes Cosmos!</p>
                </div>
                <div class="d-grid gap-2">
                    <button class="btn btn-primary">View Details</button>
                    <button class="btn btn-outline-secondary" data-bs-dismiss="modal">Continue Swiping</button>
                </div>
            </div>
        </div>
    </div>
</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
<style>
    #restaurant-card {
        transition: transform 0.3s ease;
    }

    .swipe-left {
        transform: translateX(-150%) rotate(-15deg);
        transition: all 0.5s ease;
    }

    .swipe-right {
        transform: translateX(150%) rotate(15deg);
        transition: all 0.5s ease;
    }

    #info-btn {
        opacity: 0.9;
    }

    #info-btn:hover {
        opacity: 1;
    }

    #contentOverlay {
        transition: opacity 0.5s ease;
        pointer-events: auto;
    }

    #contentOverlay>* {
        pointer-events: auto;
        /* makes sure the start button is clickable */
    }

    #contentOverlay[style*="display: none"] {
        pointer-events: none;
        /* prevents the like and dislike buttons from working before starting a group*/
    }

    .btn:disabled {
        opacity: 0.65;
        cursor: not-allowed;
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const likeBtn = document.getElementById('like-btn');
        const dislikeBtn = document.getElementById('dislike-btn');
        const infoBtn = document.getElementById('info-btn');
        const restaurantCard = document.getElementById('restaurant-card');
        const contentOverlay = document.getElementById('contentOverlay');
        const startSessionBtn = document.getElementById('startSessionBtn');
        const startSessionModal = document.getElementById('startSessionModal');

        const modal = new bootstrap.Modal(startSessionModal);

        // hide the overlay and enable buttons, also prints the status of the buttons for debugging
        startSessionBtn.addEventListener('click', function () {
            console.log('Start session button clicked');

            // I saw this in the docs
            contentOverlay.style.opacity = '0';

            // wait for the animation to finidh before enabling the buttons
            setTimeout(() => {
                contentOverlay.style.display = 'none';
                contentOverlay.style.pointerEvents = 'none'; // Ensure no interaction blocking

                // Enable the swiping buttons
                likeBtn.removeAttribute('disabled');
                dislikeBtn.removeAttribute('disabled');

                console.log('Buttons enabled:',
                    'Like button disabled?', likeBtn.disabled,
                    'Dislike button disabled?', dislikeBtn.disabled);
            }, 500);

            // close modal
            try {
                modal.hide();
            } catch (e) {
                console.error('Error hiding modal:', e);
                $(startSessionModal).modal('hide');
            }
        });

        // swiping that's kinda ugly
        likeBtn.addEventListener('click', function () {
            console.log('Like button clicked, disabled?', this.disabled);

            restaurantCard.classList.add('swipe-right');
            setTimeout(() => {
                restaurantCard.classList.remove('swipe-right');
                // api should go here
            }, 500);
        });

        dislikeBtn.addEventListener('click', function () {
            console.log('Dislike button clicked, disabled?', this.disabled);

            restaurantCard.classList.add('swipe-left');
            setTimeout(() => {
                restaurantCard.classList.remove('swipe-left');
                // and here
            }, 500);
        });

        // for testing the match modal
        // setTimeout(() => {
        //    const matchModal = new bootstrap.Modal(document.getElementById('matchModal'));
        //    matchModal.show();
        // }, 10000);
    });
</script>
{{/layout}}